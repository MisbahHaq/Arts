<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Masters - Slideshow</title>
    <link rel="stylesheet" href="slider.css" />
  </head>
  <body>
    <!-- Page transition overlay -->
    <div class="page-transition active"></div>

    <div class="slideshow-container">
      <!-- Close Button -->
      <button class="close-button">&times;</button>

      <!-- Slides -->
      <img class="slide" src="./Images/1.png" alt="Artwork 1" />
      <img class="slide" src="./Images/2.png" alt="Artwork 2" />
      <img class="slide" src="./Images/3.png" alt="Artwork 3" />
      <img class="slide" src="./Images/4.png" alt="Artwork 4" />
      <img class="slide" src="./Images/5.png" alt="Artwork 5" />
      <img class="slide" src="./Images/6.png" alt="Artwork 6" />
      <img class="slide" src="./Images/7.png" alt="Artwork 7" />
      <img class="slide" src="./Images/8.png" alt="Artwork 8" />
      <img class="slide" src="./Images/9.png" alt="Artwork 9" />
      <img class="slide" src="./Images/10.png" alt="Artwork 10" />
      <img class="slide" src="./Images/11.png" alt="Artwork 11" />
      <img class="slide" src="./Images/12.png" alt="Artwork 12" />
      <img class="slide" src="./Images/13.png" alt="Artwork 13" />
      <img class="slide" src="./Images/14.png" alt="Artwork 14" />
      <img class="slide" src="./Images/15.png" alt="Artwork 15" />
      <!-- Navigation -->
      <button class="nav-button prev">&#10094;</button>
      <button class="nav-button next">&#10095;</button>

      <!-- Slide Counter -->
      <div class="slide-counter">
        <span id="currentSlide">1</span> / <span id="totalSlides">16</span>
      </div>
    </div>

    <!-- Floating View Toggle -->
    <div class="floating-nav">
      <a href="./index.html"><button>Grid</button></a>
      <button class="active">Slider</button>
    </div>

    <script>
      const slides = document.querySelectorAll(".slide");
      const prevBtn = document.querySelector(".prev");
      const nextBtn = document.querySelector(".next");
      const closeBtn = document.querySelector(".close-button");
      const currentSlideEl = document.getElementById("currentSlide");
      const totalSlidesEl = document.getElementById("totalSlides");

      let currentIndex = 0;

      // Check URL parameter for starting slide
      const urlParams = new URLSearchParams(window.location.search);
      const slideParam = urlParams.get("slide");
      if (slideParam) {
        const slideNum = parseInt(slideParam, 10);
        if (slideNum >= 1 && slideNum <= slides.length) {
          currentIndex = slideNum - 1;
        }
      }

      totalSlidesEl.textContent = slides.length;

      // Helper to handle fade-out/fade-in transitions
      function updateSlide(index) {
        slides.forEach((slide, i) => {
          if (i === index) {
            // Remove fading-out if present
            slide.classList.remove("fading-out");
            // Add active after a short delay for smooth transition if coming from fade-out
            setTimeout(() => {
              slide.classList.add("active");
            }, 10);
          } else {
            if (slide.classList.contains("active")) {
              slide.classList.add("fading-out");
              slide.classList.remove("active");
              // Remove fading-out after transition
              setTimeout(() => {
                slide.classList.remove("fading-out");
              }, 500);
            } else {
              slide.classList.remove("active", "fading-out");
            }
          }
        });
        currentSlideEl.textContent = index + 1;
      }

      closeBtn.addEventListener("click", (e) => {
        e.preventDefault();
        transitionEl.classList.remove("hidden");
        slides[currentIndex].classList.add("closing");
        setTimeout(() => {
          window.location.href = "./index.html";
        }, 600);
      });

      prevBtn.addEventListener("click", () => {
        currentIndex = (currentIndex - 1 + slides.length) % slides.length;
        updateSlide(currentIndex);
      });

      nextBtn.addEventListener("click", () => {
        currentIndex = (currentIndex + 1) % slides.length;
        updateSlide(currentIndex);
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowLeft") prevBtn.click();
        else if (e.key === "ArrowRight") nextBtn.click();
        else if (e.key === "Escape") window.location.href = "./index.html";
      });

      // Optional swipe for mobile
      let startX = 0;
      document.addEventListener("touchstart", (e) => {
        startX = e.touches[0].clientX;
      });
      document.addEventListener("touchend", (e) => {
        let endX = e.changedTouches[0].clientX;
        if (startX - endX > 50) nextBtn.click();
        else if (endX - startX > 50) prevBtn.click();
      });

      // Appear transition for initial image on load
      window.addEventListener("DOMContentLoaded", () => {
        slides.forEach((slide, i) => {
          slide.classList.remove("active", "fading-out", "appearing");
        });
        // Add appearing class to initial slide for transition
        slides[currentIndex].classList.add("appearing");
        setTimeout(() => {
          slides[currentIndex].classList.remove("appearing");
          slides[currentIndex].classList.add("active");
          // Update UI elements
          currentSlideEl.textContent = currentIndex + 1;
        }, 700); // match transition duration in CSS
      });
    </script>
    <script>
      const transitionEl = document.querySelector(".page-transition");

      window.addEventListener("DOMContentLoaded", () => {
        // Slide up the overlay when the page finishes loading
        transitionEl.classList.add("hidden");
      });

      // Apply transition when clicking any anchor
      document.querySelectorAll("a").forEach((anchor) => {
        const href = anchor.getAttribute("href");
        if (href && !href.startsWith("#") && !href.startsWith("http")) {
          anchor.addEventListener("click", (e) => {
            e.preventDefault();
            transitionEl.classList.remove("hidden"); // Slide down
            setTimeout(() => {
              window.location.href = href;
            }, 600); // Duration matches the CSS transition
          });
        }
      });
    </script>
  </body>
</html>
